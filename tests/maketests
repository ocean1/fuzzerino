# Makefile
.PHONY: FORCE all clean emitllvm

DEBUG ?= 1
EMIT_LLVM ?= 0

CC ?= gfz-clang-fast

CFLAGS = -Wall
CFLAGS += -I ../
LLVMFLAGS=-emit-llvm -S

#LDFLAGS += ../ldscript.x
ifeq ($(DEBUG), 1)
	CFLAGS  += -g
endif


all: cleanids gtest ptest

cleanids:
	rm -f /dev/shm/gfzidfile

emitllvm: g.ll p.ll

%.ll:
	$(CC) $(CFLAGS) $(LLVMFLAGS) g.c -o $@

gtest:
	$(CC) $(CFLAGS) $(LDFLAGS) g.c -o $@

ptest:
	gcc $(CFLAGS) $(LDFLAGS) p.c -o $@
#g.o: g.c
#p.o: p.c

%.c:
	$(CC) $(CFLAGS) $@


clean:
	rm -f gtest ptest
	rm -f *.o
	rm -f *.ll
