# Makefile
.PHONY: FORCE all clean emitllvm
AFL_DONT_OPTIMIZE?=true

DEBUG ?= 0

CC ?= gfz-clang-fast

CFLAGS = -Wall
CFLAGS += -I ../
LLVMFLAGS=-emit-llvm -S

#LDFLAGS += ../ldscript.x
ifeq ($(DEBUG), 1)
	CFLAGS  += -g
endif


all: gtest ptest

cleanids:
	@rm -f /dev/shm/gfzidfile

emitllvm: g.ll

%.ll:
	@rm -f /dev/shm/gfzidfile
	$(CC) $(CFLAGS) $(LLVMFLAGS) $*.c -o $@

gtest:
	@rm -f /dev/shm/gfzidfile
	$(CC) $(CFLAGS) $(LDFLAGS) g.c -o $@

ptest:
	@rm -f /dev/shm/gfzidfile
	gcc $(CFLAGS) $(LDFLAGS) p.c -o $@

cleanll:
	rm -f *.ll

clean:
	rm -f gtest ptest
	rm -f *.o

verify:
	opt-6.0 -verify g.ll
