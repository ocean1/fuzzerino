# Makefile
.PHONY: FORCE all clean emitllvm

DEBUG ?= 0
EMIT_LLVM ?= 0

CC ?= gfz-clang-fast

CFLAGS = -Wall
CFLAGS += -I ../
LLVMFLAGS=-emit-llvm -S

#LDFLAGS += ../ldscript.x
ifeq ($(DEBUG), 1)
	CFLAGS  += -g
endif


all: gtest ptest

cleanids:
	rm -f /dev/shm/gfzidfile

emitllvm: g.ll p.ll

%.ll:
	rm -f /dev/shm/gfzidfile
	$(CC) $(CFLAGS) $(LLVMFLAGS) $*.c -o $@

gtest: cleanids
	$(CC) $(CFLAGS) $(LDFLAGS) g.c -o $@

ptest: cleanids
	gcc $(CFLAGS) $(LDFLAGS) p.c -o $@

clean:
	rm -f gtest ptest
	rm -f *.o
	rm -f *.ll
