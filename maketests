# Makefile
.PHONY: FORCE all clean

DEBUG ?= 0
EMIT_LLVM ?= 0

CC = clang
CFLAGS = -Wall

ifeq ($(DEBUG), 1)
	CFLAGS  += -g
endif

ifeq ($(EMIT_LLVM), 1)
	CFLAGS += -emit-llvm -S
endif


ifeq ($(EMIT_LLVM), 1)
%.ll:
	$(CC) $(CFLAGS) g.c -o $@

all: g.ll p.ll

else

all: t_g t_p

t_%: %.o
	$(CC) $< -o $* $(CFLAGS)

g.o: g.c
p.o: p.c

%.c:
	$(CC) $(CFLAGS) -c $@

endif

clean:
	rm -f g p
	rm -f *.o
	rm -f *.ll
